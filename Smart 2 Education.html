<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Education system</title>
  <style>
    :root{
      --bg:#f4f6fb; --card:#ffffff; --muted:#6b7280; --accent:#2563eb;
      --accent-2:#0ea5a4; --success:#10b981;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{margin:0;background:var(--bg);color:#111;}
    .wrap{max-width:1100px;margin:28px auto;padding:20px;}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;}
    header h1{font-size:20px;margin:0;}
    .grid{display:grid;gap:16px;}
    .kpis{grid-template-columns:repeat(3,1fr);display:grid;}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(12,15,24,0.06);}
    .kpi .value{font-size:24px;font-weight:700;}
    .kpi .label{color:var(--muted);font-size:13px;margin-top:6px;}
    .charts{display:grid;grid-template-columns:1fr 420px;gap:16px;}
    .section-title{font-size:14px;margin:0 0 8px 0;color:var(--muted);}
    canvas{width:100%;height:260px;display:block;}
    .small-canvas{height:160px;}
    .heatmap{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;}
    .heatmap .cell{height:28px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff;}
    .leaderboard li{list-style:none;padding:8px 0;border-bottom:1px dashed #eee;display:flex;justify-content:space-between;}
    .leaderboard strong{font-weight:600;}
    .donut-wrap{display:flex;align-items:center;gap:12px;}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
    footer{margin-top:18px;font-size:12px;color:var(--muted);text-align:center}
    @media (max-width:900px){
      .charts{grid-template-columns:1fr; }
      .kpis{grid-template-columns:repeat(1,1fr);}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Smart Education — Analytics </h1>
      <div style="font-size:13px;color:var(--muted)">Demo • No backend</div>
    </header>

    <!-- KPI cards -->
    <div class="grid kpis" style="margin-bottom:12px;">
      <div class="card kpi" id="kpiAvg">
        <div class="label">Average Score</div>
        <div class="value" id="avgScore">—</div>
        <div class="hint">Overall across all subjects & exams</div>
      </div>
      <div class="card kpi" id="kpiPass">
        <div class="label">Pass Rate</div>
        <div class="value" id="passRate">—</div>
        <div class="hint">Percent of scores ≥ 40</div>
      </div>
      <div class="card kpi" id="kpiTop">
        <div class="label">Top Student</div>
        <div class="value" id="topStudent">—</div>
        <div class="hint">Highest average score</div>
      </div>
    </div>

    <div class="charts">
      <!-- Left: charts column -->
      <div style="display:flex;flex-direction:column;gap:16px;">
        <div class="card">
          <p class="section-title">Subject-wise Averages</p>
          <canvas id="barChart" aria-label="Subject averages chart"></canvas>
        </div>

        <div class="card">
          <p class="section-title">Exam Trend</p>
          <canvas id="lineChart" class="small-canvas" aria-label="Exam trend chart"></canvas>
        </div>

        <div class="card">
          <p class="section-title">Timetable / Study Heatmap (Mon-Sun × Hours 6–22)</p>
          <div id="heatmap" class="heatmap" style="margin-top:8px;"></div>
        </div>
      </div>

      <!-- Right: side column -->
      <div style="display:flex;flex-direction:column;gap:16px;">
        <div class="card">
          <p class="section-title">Gamified Leaderboard</p>
          <ul class="leaderboard" id="leaderboard" style="padding:8px 0;margin:0;"></ul>
          <div class="hint">Points = 0.8 * avg_score + 0.2 * attendance%</div>
        </div>

        <div class="card">
          <p class="section-title">Example Student Progress</p>
          <div class="donut-wrap">
            <!-- Donut SVG -->
            <svg id="donut" width="120" height="120" viewBox="0 0 42 42" role="img" aria-label="Progress donut">
              <circle cx="21" cy="21" r="15.9" fill="transparent" stroke="#eee" stroke-width="7"></circle>
              <circle id="donutArc" cx="21" cy="21" r="15.9" fill="transparent" stroke-width="7"
                      stroke-linecap="round" transform="rotate(-90 21 21)"></circle>
              <text id="donutText" x="21" y="23.5" text-anchor="middle" font-size="6" fill="#111"></text>
            </svg>
            <div>
              <div style="font-weight:700" id="exampleName">Student 1</div>
              <div style="color:var(--muted);margin-top:6px" id="exampleHint">Mastered topics</div>
            </div>
          </div>
        </div>

        <div class="card">
          <p class="section-title">Data Controls</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="regen" style="padding:8px 10px;border-radius:6px;border:0;background:var(--accent);color:#fff;cursor:pointer">Regenerate Data</button>
            <button id="randomize" style="padding:8px 10px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer">Randomize Sessions</button>
          </div>
          <div class="hint">Use the buttons to see how charts update with new data.</div>
        </div>
      </div>
    </div>

    <footer>
      Built with plain HTML, CSS & JavaScript • Save this file as <code>index.html</code> and open in your browser.
    </footer>
  </div>

  <script>
  /***** SAMPLE DATA GENERATION (client-side) *****/
  function makeSampleData() {
    // names and subjects
    const students = Array.from({length:40}, (_,i) => `Student ${i+1}`);
    const subjects = ["Math", "Physics", "Chemistry", "English", "History"];
    const exams = ["Exam 1", "Exam 2", "Exam 3", "Exam 4"];

    // scores: student x subject x exam
    const scores = [];
    for (const s of students) {
      // each student has a base ability
      const base = Math.max(40, Math.min(95, Math.round(65 + (Math.random()-0.5)*15)));
      for (const sub of subjects) {
        for (let e=0;e<exams.length;e++){
          // small improvement across exams
          const mean = base + e*2 + (Math.random()-0.5)*8;
          const sc = Math.max(0, Math.min(100, Math.round(mean + (Math.random()-0.5)*12)));
          scores.push({student:s, subject:sub, exam:exams[e], score:sc});
        }
      }
    }

    // attendance %
    const attendance = students.map(s => ({student:s, attendance: Math.max(50, Math.min(100, Math.round(85 + (Math.random()-0.5)*12)))}));

    // study sessions heatmap: 7 days x 17 hours (6..22)
    const heat = Array.from({length:7}, ()=> Array.from({length:17}, ()=>0));
    for (let i=0;i<students.length;i++){
      const sessions = Math.floor(Math.random()*40) + 10;
      for (let k=0;k<sessions;k++){
        const d = Math.floor(Math.random()*7);
        const h = Math.floor(Math.random()*17);
        heat[d][h] += 1;
      }
    }

    return {students, subjects, exams, scores, attendance, heat};
  }

  // global state
  let state = makeSampleData();

  /***** AGGREGATIONS *****/
  function metricsFromState(st) {
    const allScores = st.scores.map(d=>d.score);
    const avg = Math.round((allScores.reduce((a,b)=>a+b,0)/allScores.length)*10)/10;
    const passRate = Math.round((allScores.filter(s=>s>=40).length / allScores.length) * 1000)/10;
    // subject averages
    const subjMap = {};
    st.subjects.forEach(sub => subjMap[sub]=[]);
    st.scores.forEach(r => subjMap[r.subject].push(r.score));
    const subjectAvg = st.subjects.map(s => ({subject:s, avg: Math.round((subjMap[s].reduce((a,b)=>a+b,0)/subjMap[s].length)*10)/10}));

    // exam trends
    const examMap = {};
    st.exams.forEach(e=>examMap[e]=[]);
    st.scores.forEach(r => examMap[r.exam].push(r.score));
    const examTrend = st.exams.map(e => ({exam:e, avg: Math.round((examMap[e].reduce((a,b)=>a+b,0)/examMap[e].length)*10)/10}));

    // student averages
    const stu = {};
    st.students.forEach(s=>stu[s]=[]);
    st.scores.forEach(r => stu[r.student].push(r.score));
    const studentAvg = Object.entries(stu).map(([student, scores]) => ({student, avg: Math.round((scores.reduce((a,b)=>a+b,0)/scores.length)*10)/10}));
    // merge attendance and compute points
    const withAttendance = studentAvg.map(s=>{
      const att = st.attendance.find(a=>a.student===s.student).attendance;
      const points = Math.round((s.avg*0.8 + att*0.2)*10)/10;
      return {...s, attendance:att, points};
    });
    withAttendance.sort((a,b)=>b.points - a.points);
    const leaderboard = withAttendance.slice(0,10);

    return {avg, passRate, subjectAvg, examTrend, leaderboard};
  }

  /***** RENDERERS *****/
  const avgScoreEl = document.getElementById('avgScore');
  const passRateEl = document.getElementById('passRate');
  const topStudentEl = document.getElementById('topStudent');
  const leaderboardEl = document.getElementById('leaderboard');
  const heatmapEl = document.getElementById('heatmap');
  const exampleNameEl = document.getElementById('exampleName');
  const donutArc = document.getElementById('donutArc');
  const donutText = document.getElementById('donutText');

  function renderKPIs() {
    const m = metricsFromState(state);
    avgScoreEl.textContent = m.avg;
    passRateEl.textContent = m.passRate + '%';
    topStudentEl.textContent = m.leaderboard[0].student + ' (' + m.leaderboard[0].avg + ')';
  }

  // Simple bar chart (Canvas)
  function drawBarChart() {
    const canvas = document.getElementById('barChart');
    canvas.width = canvas.clientWidth;
    canvas.height = 260;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const m = metricsFromState(state);
    const data = m.subjectAvg;
    const padding = 40;
    const chartW = canvas.width - padding*2;
    const chartH = canvas.height - padding*2;
    const maxVal = 100;
    const barW = chartW / data.length * 0.6;
    // draw background grid lines
    ctx.strokeStyle = '#eee';
    ctx.lineWidth = 1;
    for (let i=0;i<=5;i++){
      const y = padding + (chartH/5)*i;
      ctx.beginPath(); ctx.moveTo(padding, y); ctx.lineTo(padding+chartW, y); ctx.stroke();
      const val = Math.round((5-i)*(maxVal/5));
      ctx.fillStyle = '#999'; ctx.font = '11px Arial'; ctx.fillText(val, 6, y+4);
    }
    // bars
    data.forEach((d,i)=>{
      const x = padding + i*(chartW/data.length) + (chartW/data.length - barW)/2;
      const h = (d.avg / maxVal) * chartH;
      const y = padding + chartH - h;
      // gradient
      const grad = ctx.createLinearGradient(0,y,0,y+h);
      grad.addColorStop(0, '#60a5fa'); grad.addColorStop(1, '#2563eb');
      ctx.fillStyle = grad;
      roundRect(ctx, x, y, barW, h, 6, true, false);
      // labels
      ctx.fillStyle = '#444'; ctx.font = '12px Arial';
      ctx.fillText(d.subject, x, padding+chartH+16);
      ctx.fillStyle = '#fff'; ctx.font = '12px Arial';
      ctx.fillText(d.avg, x + barW/2 - 8, y + 14);
    });
  }

  // line chart for exam trend
  function drawLineChart() {
    const canvas = document.getElementById('lineChart');
    canvas.width = canvas.clientWidth;
    canvas.height = 160;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const m = metricsFromState(state);
    const data = m.examTrend;
    const padding = 30;
    const chartW = canvas.width - padding*2;
    const chartH = canvas.height - padding*2;
    const maxVal = 100;
    // axes
    ctx.strokeStyle = '#eee'; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(padding, padding); ctx.lineTo(padding, padding+chartH); ctx.lineTo(padding+chartW, padding+chartH); ctx.stroke();
    // points
    ctx.fillStyle = '#0ea5a4'; ctx.strokeStyle = '#0ea5a4'; ctx.lineWidth = 2;
    data.forEach((d,i)=>{
      const x = padding + (i/(data.length-1 || 1)) * chartW;
      const y = padding + chartH - (d.avg/maxVal)*chartH;
      if (i===0){ ctx.beginPath(); ctx.moveTo(x,y); } else { ctx.lineTo(x,y); }
      // label
      ctx.fillStyle='#444'; ctx.font='11px Arial'; ctx.fillText(d.exam, x-16, padding+chartH+14);
      ctx.fillStyle = '#0ea5a4';
      roundRect(ctx, x-4, y-4, 8, 8, 3, true, false);
      // number
      ctx.fillStyle = '#333'; ctx.font='11px Arial'; ctx.fillText(d.avg, x-12, y-10);
    });
    ctx.stroke();
  }

  // simple helper to draw rounded rect
  function roundRect(ctx, x, y, w, h, r, fill, stroke) {
    if (w < 2 * r) r = w / 2;
    if (h < 2 * r) r = h / 2;
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y,   x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x,   y+h, r);
    ctx.arcTo(x,   y+h, x,   y,   r);
    ctx.arcTo(x,   y,   x+w, y,   r);
    ctx.closePath();
    if (fill) { ctx.fill(); }
    if (stroke) { ctx.stroke(); }
  }

  function renderLeaderboard() {
    const m = metricsFromState(state);
    leaderboardEl.innerHTML = '';
    m.leaderboard.forEach((p, idx)=>{
      const li = document.createElement('li');
      li.innerHTML = `<span>${idx+1}. ${p.student}</span><strong>${p.points}</strong>`;
      leaderboardEl.appendChild(li);
    });
  }

  function renderHeatmap() {
    heatmapEl.innerHTML = '';
    const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
    // header for hours
    const hours = Array.from({length:17}, (_,i)=>6+i);
    // show day labels + 17 cells per day (8 columns layout: day + 17 hour cells -> we adapt by showing row-by-row)
    // For simple grid, we'll create 7 rows, each with 18 cells (day label + 17 hour cells).
    // But our CSS grid uses 8 columns; so instead show day label and grouped small strip (aggregate color).
    // Simpler: show 7 * 8 grid where each cell is aggregated range of hours (we'll compress hours into 8 buckets)
    const raw = state.heat;
    // compress 17 -> 7 buckets for nicer grid
    const buckets = 8;
    for (let d=0; d<7; d++){
      // day label cell (span 1)
      const labelCell = document.createElement('div');
      labelCell.textContent = days[d];
      labelCell.className = 'cell';
      labelCell.style.background = '#111';
      labelCell.style.opacity = '0.06';
      labelCell.style.color = '#111';
      heatmapEl.appendChild(labelCell);
      // create bucket cells
      for (let b=0;b<buckets-1;b++){
        const from = Math.floor(b*(17/(buckets-1)));
        const to = Math.floor((b+1)*(17/(buckets-1)));
        let sum = 0;
        for (let h=from; h<to; h++) sum += raw[d][h] || 0;
        const cell = document.createElement('div');
        cell.className = 'cell';
        const intensity = Math.min(1, sum / 12); // normalize for color
        const col = lerpColor([237,247,255], [6,78,118], intensity); // light blue -> deep
        cell.style.background = `rgb(${col.join(',')})`;
        cell.textContent = sum > 0 ? sum : '';
        heatmapEl.appendChild(cell);
      }
    }
    // helper lerp color from rgb arrays
    function lerpColor(a,b,t){ return [Math.round(a[0]+(b[0]-a[0])*t), Math.round(a[1]+(b[1]-a[1])*t), Math.round(a[2]+(b[2]-a[2])*t)]; }
  }

  function renderDonut() {
    // take example student (first in leaderboard)
    const m = metricsFromState(state);
    const ex = m.leaderboard[0];
    exampleNameEl.textContent = ex.student;
    // compute mastery: percent of subjects with avg >=60 for that student
    const stuScores = state.scores.filter(r=>r.student===ex.student);
    const subjMap = {};
    stuScores.forEach(r=> { subjMap[r.subject] = subjMap[r.subject] || []; subjMap[r.subject].push(r.score); });
    const subjAvgs = Object.keys(subjMap).map(s=> subjMap[s].reduce((a,b)=>a+b,0)/subjMap[s].length);
    const mastered = subjAvgs.filter(v=>v>=60).length;
    const masteryPct = Math.round((mastered / subjAvgs.length)*100);
    // set arc stroke-dasharray on svg circle (circumference = 2πr where r=15.9 -> ~100)
    const arc = masteryPct; // percent
    donutArc.setAttribute('stroke', arc>=60 ? '#10b981' : '#f59e0b');
    const dash = arc + ' 100';
    donutArc.setAttribute('stroke-dasharray', dash);
    donutText.textContent = masteryPct + '%';
    document.getElementById('exampleHint').textContent = `${mastered} / ${subjAvgs.length} subjects mastered`;
  }

  /***** INITIAL RENDER *****/
  function renderAll(){
    renderKPIs();
    drawBarChart();
    drawLineChart();
    renderLeaderboard();
    renderHeatmap();
    renderDonut();
  }

  // Wire buttons
  document.getElementById('regen').addEventListener('click', ()=>{
    state = makeSampleData();
    renderAll();
  });
  document.getElementById('randomize').addEventListener('click', ()=>{
    // just randomize heat sessions
    state.heat = state.heat.map(row => row.map(v => Math.max(0, v + Math.floor((Math.random()-0.5)*6))));
    renderHeatmap();
  });

  // initial
  renderAll();

  // redraw on resize for canvases
  window.addEventListener('resize', ()=> {
    drawBarChart(); drawLineChart();
  });
  </script>
</body>
</html>
